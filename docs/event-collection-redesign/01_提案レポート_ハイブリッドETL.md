# 提案レポート（批判的レビュー＋移行方針）

## 結論
- LLM（Gemini）単独で最新の地域イベントを網羅・正確に取得するのは不適切。
- 推奨は「一次ソース中心の収集（RSS/ICS/API/静的HTML）＋最小限のLLM補助（分類・要約・正規化）」のハイブリッドETLへ移行。

## 現行アプローチへの批判
- 信頼性: 出典不明・幻生成の区別が困難、監査不能。
- 網羅性: 地方イベントは分散・表記ゆれ大。探索依存は抜け漏れ常態化。
- 再現性: 同プロンプトでも再現が揺れる。差分追跡・回帰検知が難。
- コスト/遅延: 呼び出し回数増で遅延・費用が読みづらい。
- 法務/運用: robots/規約の遵守やレート制御をLLM経由で担保しづらい。

## 目標像（ハイブリッドETL）
- 収集: RSS/ICS/APIを最優先。なければ静的HTML、必要時のみ動的レンダリング。
- 正規化: 共通イベントスキーマに変換し、重複排除・品質ゲートを適用。
- 充実化: LLMは「分類・短文要約・住所→地名抽出」など補助用途に限定。
- 監査: 出典URL、取得時刻、スナップショット、ETag/Last-Modifiedを保存。
- 配信: REST/GraphQL＋全文検索（Typesense/Meilisearch）＋ICSエクスポート。

## 想定アーキテクチャ
- 収集層: Scraperアダプタ（rss|ics|api|html）＋ジョブスケジューラ（cron/Queue）。
- 処理層: 正規化（スキーマ整形）、重複排除（キー＋類似度）、充実化（LLM補助）。
- 保管層: PostgreSQL（PostGIS推奨）＋オブジェクトストレージ（スナップショット）。
- 配信層: API（REST/GraphQL）＋検索エンジン＋ICS生成。
- 監視層: メトリクス（取得件数/失敗率/サイト別ヘルス）、ログ、通知。

### 共通イベントスキーマ（最小）
- id, title, description, starts_at, ends_at, venue, city, lat, lon, category, price, organizer, source_url, source_id, last_seen, created_at, updated_at

### 重複排除
- キー: title_clean + date(開始) + venue（未取得時はcity）
- 類似度: rapidfuzz等でタイトル類似を併用しヒューマンレビュー待機バケットを用意。

## 岩手向けデータソース優先順位（概要）
- 公式/観光: 岩手県観光ポータル、県/市町村イベントカレンダー。
- 文化施設: 県民会館、アイーナ、美術館、主要ホール/図書館/博物館。
- IT/コミュニティ: Connpass API、Doorkeeper API、Peatix（必要時スクレイピング）。
- チケット: ぴあ、e+、ローソン、PassMarket（要個別対応）。
- メディア: Walkerplus、Yahoo!ロコ、岩手日報、テレビ局イベント欄。
- スポーツ: グルージャ盛岡、ビッグブルズ、釜石シーウェイブス。
- 教育機関: 岩手大学、県立大学ほか公開講座・学園祭。
→ 詳細は「05_情報源リスト_岩手.md」を参照。

## 段階的移行プラン
- フェーズ1: RSS/ICS/API対応ソースのみで土台構築（1〜2週）。
- フェーズ2: 主要施設の静的HTMLスクレイピング追加、品質ゲート/重複排除安定化（2〜3週）。
- フェーズ3: 難所（チケット系/動的）を個別アダプタで段階導入（継続）。
- フェーズ4: LLM補助（カテゴリ/要約）をオンにし効果測定（1週）。
- フェーズ5: 管理UI（失敗アラート、重複マージ、手動修正）整備（2週）。

## 成功指標（KPI）
- 網羅性: 主要ソースの検出率 ≥ 95%、重複率 ≤ 5%。
- 正確性: 日付/会場/URLの整合率 ≥ 99%。
- 新鮮度: 重要ソースの反映遅延 ≤ 6時間（通常 ≤ 24時間）。
- 安定性: ソース別失敗率 ≤ 2%（7日移動平均）。
- 運用: 週次の人手修正 ≤ 10件、月次アダプタ修正 ≤ 3サイト。
- コスト: 月額API/推論費用の上限を固定（例: 5,000円以内）。

## リスクと対策
- DOM変更: 早期検知（監視＋スナップショットdiff）とフォールバック（html→headless）。
- 法務: robots/規約順守、データ出典明記、掲載許諾の取得フロー整備。
- 精度: 住所/地名の曖昧性はNominatim＋人手レビューで補正。
- 依存: 特定サイト依存を避け、同カテゴリで代替ソースを常備。

## 予算と工数概算（初期）
- 初期構築: 2〜4人週（収集/正規化/重複排除/監視の最小構成）。
- 維持運用: 月3〜6人日（アダプタ調整/障害対応/ソース追加）。
- ランニング: サーバ（小規模）、DB、検索、少量LLM/ジオコーディングAPIで月数千円〜。

## 次のアクション
- 最小PoCとして「RSS/ICS/APIのみで岩手10〜15ソース」を1週間分集約し、KPIを測定。
- 設計詳細は要件定義・仕様・機能設計の各ドキュメントに準拠。
