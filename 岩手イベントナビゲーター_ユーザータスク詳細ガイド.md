# 岩手イベントナビゲーター - ユーザータスク詳細ガイド

## 📋 概要

このガイドでは、岩手イベントナビゲーターをCloudflare Pagesで**完全無料**デプロイするために、**ユーザー側で必要な作業**を詳しく説明します。

**所要時間**: 約1-2時間  
**必要なもの**: GitHubアカウント、メールアドレス、独自ドメイン（オプション）

---

## 🎯 ユーザータスク一覧

### ✅ 必須タスク（無料デプロイに必要）
1. [Cloudflareアカウント作成](#1-cloudflareアカウント作成)
2. [GitHub連携設定](#2-github連携設定)
3. [Cloudflare Pages設定](#3-cloudflare-pages設定)
4. [環境変数設定](#4-環境変数設定)

### 🔧 オプショナルタスク（推奨）
5. [カスタムドメイン設定](#5-カスタムドメイン設定オプション)
6. [SSL/TLS最適化](#6-ssltls最適化)
7. [パフォーマンス監視設定](#7-パフォーマンス監視設定)

---

## 1. Cloudflareアカウント作成

### 1.1 アカウント登録

**手順**:
1. https://cloudflare.com にアクセス
2. 右上の「Sign Up」をクリック
3. 以下の情報を入力：
   - **Email**: あなたのメールアドレス
   - **Password**: 8文字以上の強力なパスワード
4. 「Create Account」をクリック
5. 確認メールが届くので、メール内のリンクをクリックして認証

**⚠️ 注意事項**:
- 無料プラン（Free Plan）を選択してください
- クレジットカード情報は不要です
- メール認証を必ず完了してください

### 1.2 ダッシュボード確認

**確認項目**:
- ログイン後、Cloudflareダッシュボードが表示される
- 左側メニューに「Pages」が表示されることを確認
- 画面右上にアカウント名が表示されることを確認

**スクリーンショット参考**:
```
[Cloudflare Dashboard]
┌─────────────────────────────────────┐
│ ☁️ Cloudflare                        │
│ ├ Overview                          │
│ ├ Analytics                         │
│ ├ Pages          ← これを確認        │
│ ├ Workers                           │
│ └ ...                               │
└─────────────────────────────────────┘
```

---

## 2. GitHub連携設定

### 2.1 事前確認

**必要なGitHubリポジトリ**:
- 岩手イベントナビゲーターのソースコードがあるリポジトリ
- リポジトリ名例: `iwate-event-navigator`
- ブランチ: `main` または `master`

**確認方法**:
1. GitHubにログイン
2. リポジトリページで以下を確認：
   - `package.json` が存在する
   - `src/` ディレクトリが存在する
   - `public/` ディレクトリが存在する

### 2.2 Cloudflare Pages でGitHub連携

**手順**:
1. Cloudflareダッシュボードで「Pages」をクリック
2. 「Create a project」をクリック
3. 「Connect to Git」を選択
4. 「GitHub」を選択
5. GitHub認証画面が表示される：
   - 「Authorize Cloudflare」をクリック
   - GitHubのパスワードを入力（必要に応じて）

**権限設定**:
- 「All repositories」または「Selected repositories」を選択
- Selected repositoriesの場合、岩手イベントナビゲーターのリポジトリを選択
- 「Install & Authorize」をクリック

---

## 3. Cloudflare Pages設定

### 3.1 プロジェクト作成

**手順**:
1. GitHub連携後、リポジトリ一覧が表示される
2. 岩手イベントナビゲーターのリポジトリを選択
3. 「Begin setup」をクリック

### 3.2 ビルド設定

**重要**: 以下の設定を**正確に**入力してください：

| 項目 | 設定値 | 説明 |
|-----|--------|------|
| **Project name** | `iwate-event-navigator` | プロジェクト名（変更可能） |
| **Production branch** | `main` | デプロイするブランチ |
| **Framework preset** | `Vite` | フレームワークを選択 |
| **Build command** | `npm run build` | ビルドコマンド |
| **Build output directory** | `dist` | 出力ディレクトリ |
| **Root directory** | `/` | ルートディレクトリ |

**設定例**:
```
┌─────────────────────────────────────┐
│ Project name: iwate-event-navigator │
│ Production branch: main             │
│ Framework preset: Vite              │
│ Build command: npm run build        │
│ Build output directory: dist        │
│ Root directory: /                   │
└─────────────────────────────────────┘
```

### 3.3 デプロイ開始

**手順**:
1. 設定を確認して「Save and Deploy」をクリック
2. 初回ビルドが開始される（5-10分程度）
3. ビルドログを確認：
   - ✅ **Success**: ビルド成功
   - ❌ **Failed**: エラーが発生（次のセクション参照）

### 3.4 トラブルシューティング

**よくあるエラーと解決方法**:

#### エラー1: `npm install` 失敗
```bash
Error: npm install failed
```
**解決方法**:
- GitHubリポジトリに `package.json` があることを確認
- Node.jsバージョンが適切か確認（`.nvmrc` ファイルがある場合）

#### エラー2: ビルド失敗
```bash
Error: npm run build failed
```
**解決方法**:
1. Cloudflare Pages設定で「Environment variables」タブを開く
2. 以下を追加：
   - Name: `NODE_VERSION`
   - Value: `18` または `20`

#### エラー3: TypeScriptエラー
```bash
Error: TypeScript compilation failed
```
**解決方法**:
- Build commandを変更: `npm run build -- --skip-type-check`

---

## 4. 環境変数設定

### 4.1 Gemini API キー取得

**手順**:
1. https://aistudio.google.com/app/apikey にアクセス
2. Googleアカウントでログイン
3. 「Create API Key」をクリック
4. API キーをコピー（例: `AIzaSyC...`）

**⚠️ セキュリティ注意**:
- API キーは他人に共有しないでください
- 安全な場所にバックアップしてください

### 4.2 Cloudflare Pages環境変数設定

**手順**:
1. Cloudflare Pagesプロジェクトページを開く
2. 「Settings」タブをクリック
3. 「Environment variables」セクションを開く
4. 「Add variable」をクリック
5. 以下を入力：
   - **Variable name**: `VITE_GEMINI_API_KEY`
   - **Value**: 取得したGemini API キー
   - **Environment**: `Production` を選択
6. 「Save」をクリック

**設定例**:
```
┌─────────────────────────────────────────┐
│ Variable name: VITE_GEMINI_API_KEY      │
│ Value: AIzaSyC1234567890abcdef...       │
│ Environment: Production ✓               │
└─────────────────────────────────────────┘
```

### 4.3 再デプロイ実行

**手順**:
1. 「Deployments」タブに移動
2. 最新のデプロイの右側の「...」をクリック
3. 「Retry deployment」を選択
4. 環境変数が適用された状態で再ビルドされる

---

## 5. カスタムドメイン設定（オプション）

### 5.1 ドメイン取得

**推奨レジストラ**:
- **お名前.com** (日本語サポート)
- **ムームードメイン** (日本語サポート)
- **Cloudflare Registrar** (英語、最安値)

**推奨ドメイン例**:
- `iwate-events.com`
- `iwate-navigator.jp`
- `events-iwate.net`

### 5.2 Cloudflare DNS設定

**手順**:
1. ドメインレジストラでネームサーバーをCloudflareに変更：
   ```
   ada.ns.cloudflare.com
   carter.ns.cloudflare.com
   ```

2. Cloudflareダッシュボードで：
   - 「Add a Site」をクリック
   - ドメイン名を入力
   - 無料プランを選択
   - DNS設定を確認

### 5.3 Pages カスタムドメイン追加

**手順**:
1. Pagesプロジェクトの「Custom domains」タブを開く
2. 「Set up a custom domain」をクリック
3. ドメイン名を入力（例: `iwate-events.com`）
4. 「Continue」をクリック
5. DNS設定が自動で追加される
6. SSL証明書が自動発行される（数分〜1時間）

**確認方法**:
- カスタムドメインでアクセスして動作確認
- `https://` でアクセスできることを確認

---

## 6. SSL/TLS最適化

### 6.1 セキュリティ設定

**手順**:
1. Cloudflareダッシュボードでドメインを選択
2. 「SSL/TLS」タブをクリック
3. 「Overview」で以下を設定：
   - **Encryption mode**: `Full (strict)` を選択
4. 「Edge Certificates」で以下を有効化：
   - ✅ Always Use HTTPS
   - ✅ HTTP Strict Transport Security (HSTS)
   - ✅ Minimum TLS Version: TLS 1.2

**セキュリティヘッダー設定**:
1. 「Security」タブをクリック
2. 以下を有効化：
   - ✅ Security Level: Medium
   - ✅ Challenge Passage: 30 minutes
   - ✅ Browser Integrity Check

---

## 7. パフォーマンス監視設定

### 7.1 Analytics有効化

**手順**:
1. Pagesプロジェクトの「Analytics」タブを開く
2. 「Web Analytics」を有効化
3. ビーコンコードが自動追加される

### 7.2 Speed最適化

**手順**:
1. Cloudflareダッシュボードの「Speed」タブを開く
2. 以下を有効化：
   - ✅ Auto Minify (HTML, CSS, JS)
   - ✅ Brotli compression
   - ✅ Early Hints

### 7.3 Caching最適化

**手順**:
1. 「Caching」タブを開く
2. 「Configuration」で以下を設定：
   - **Caching Level**: Standard
   - **Browser Cache TTL**: 1 month

---

## 🎉 完了確認

### 最終チェックリスト

**基本機能確認**:
- [ ] アプリケーションがhttps://でアクセスできる
- [ ] 岩手県の地図が正常に表示される
- [ ] イベント検索機能が動作する
- [ ] Gemini AI連携が機能する
- [ ] モバイル表示が適切である

**パフォーマンス確認**:
- [ ] ページ読み込み時間が3秒以内
- [ ] Lighthouse Performanceスコア80以上
- [ ] エラーメッセージが表示されない

**セキュリティ確認**:
- [ ] HTTPS強制リダイレクトが動作
- [ ] セキュリティヘッダーが設定済み
- [ ] API キーが適切に保護されている

### 📊 運用開始後の期待効果

**ユーザー向け**:
- ✅ **完全無料**で本格的なイベント検索アプリを提供
- ✅ **高速表示**（Cloudflareグローバルエッジネットワーク）
- ✅ **モバイル対応**（レスポンシブデザイン）
- ✅ **AI活用**（Gemini APIによるイベント推薦）

**運用者向け**:
- ✅ **メンテナンスフリー**（サーバー管理不要）
- ✅ **自動スケーリング**（アクセス増加に自動対応）
- ✅ **継続的デプロイ**（GitHubプッシュで自動更新）
- ✅ **詳細分析**（アクセス解析・パフォーマンス監視）

---

## 🆘 トラブルシューティング

### よくある問題と解決方法

#### 問題1: ビルドが失敗する
**症状**: Deploymentが「Failed」になる
**解決方法**:
1. Build logsを確認
2. エラーメッセージをGoogleで検索
3. 環境変数設定を再確認
4. Node.jsバージョンを明示的に指定

#### 問題2: APIが動作しない
**症状**: イベント検索ができない
**解決方法**:
1. 環境変数名を確認: `VITE_GEMINI_API_KEY`
2. API キーの有効性を確認
3. CORS設定を確認（将来的にWorkers実装時）

#### 問題3: カスタムドメインが機能しない
**症状**: 独自ドメインでアクセスできない
**解決方法**:
1. DNSプロパゲーション待機（最大48時間）
2. ネームサーバー設定を再確認
3. SSL証明書発行完了を待機

#### 問題4: パフォーマンスが遅い
**症状**: ページ読み込みが遅い
**解決方法**:
1. キャッシュ設定を確認
2. 画像最適化を実装
3. 不要なライブラリを削除

---

## 📞 サポート・参考情報

### 公式ドキュメント
- [Cloudflare Pages](https://developers.cloudflare.com/pages/)
- [Vite Deploy Guide](https://vitejs.dev/guide/static-deploy.html)
- [Google Gemini API](https://ai.google.dev/docs)

### コミュニティサポート
- [Cloudflare Community](https://community.cloudflare.com/)
- [Stack Overflow](https://stackoverflow.com/questions/tagged/cloudflare-pages)

### 追加機能開発
次のステップとして以下の機能追加を検討：
1. **PWA対応** (オフライン機能)
2. **プッシュ通知** (新着イベント通知)
3. **地図キャッシュ** (オフライン地図)
4. **リアルタイム更新** (WebSocket連携)

---

**作成日**: 2025年8月13日  
**対象システム**: 岩手イベントナビゲーター  
**推奨デプロイ方法**: Cloudflare Pages (無料プラン)  
**想定完了時間**: 1-2時間