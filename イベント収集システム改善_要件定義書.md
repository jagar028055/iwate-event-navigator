# 岩手イベントナビゲーター - イベント収集システム改善要件定義書

## 1. プロジェクト概要

### 1.1 目的
現在の単発API呼び出し（最大50件）から、多段階収集システムによる大幅な情報量増加（目標200-300件）を実現し、特に地域密着型イベント（祭り、地域行事）の収集を強化する。

### 1.2 現状の課題
- 単一API呼び出しによる件数制限（50件上限）
- 地域密着イベントの収集不足
- リアルタイム更新機能の不備
- イベント情報の鮮度管理なし

### 1.3 期待効果
- イベント収集数: 50件 → 200-300件
- 地域密着イベント比率: 30% → 70%
- 情報鮮度: 手動更新 → 自動定期更新
- ユーザー満足度向上

## 2. 機能要件

### 2.1 多段階イベント収集システム

#### 2.1.1 Stage 1: 大規模イベント収集
- **対象**: 県・市町村公式サイト、観光協会
- **収集数**: 50-80件
- **更新頻度**: 週1回
- **実装方法**: Gemini API + Google Search

#### 2.1.2 Stage 2: 地域別詳細収集
- **対象**: 岩手県33市町村の個別収集
- **収集数**: 100-150件
- **更新頻度**: 隔日
- **実装方法**: 市町村別専用プロンプト

#### 2.1.3 Stage 3: カテゴリ別深掘り収集
- **対象**: 祭り・グルメ・文化イベント専門収集
- **収集数**: 50-70件
- **更新頻度**: 毎日
- **実装方法**: カテゴリ特化型検索

### 2.2 専門情報源統合

#### 2.2.1 祭り・伝統行事情報源
```
- 岩手県神社庁公式サイト
- 各市町村文化財課
- 地域祭り保存会
- 岩手県民俗芸能協会
```

#### 2.2.2 グルメ・物産イベント情報源
```
- JA岩手各支部イベント情報
- 道の駅連絡会
- 商工会議所各支部
- 岩手県物産協会
```

#### 2.2.3 文化・体験イベント情報源
```
- 公民館・文化センター
- 地域コミュニティセンター
- NPO・地域団体
- 教育委員会
```

### 2.3 定期更新・キャッシングシステム

#### 2.3.1 更新スケジュール
- **毎日**: 新規イベント差分取得
- **隔日**: 地域別更新ローテーション
- **週1回**: 全件再検証・重複排除
- **月1回**: データクレンジング

#### 2.3.2 キャッシング戦略
- **メモリキャッシュ**: 当日アクセス頻度高データ
- **LocalStorage**: ユーザー固有フィルタ結果
- **IndexedDB**: 全イベントデータ（オフライン対応）

## 3. 非機能要件

### 3.1 パフォーマンス
- 初回ロード時間: 3秒以内
- 検索応答時間: 1秒以内
- 更新処理時間: バックグラウンド実行

### 3.2 可用性
- システム稼働率: 99.5%以上
- API呼び出し失敗時の代替手段提供
- オフライン時の基本機能継続

### 3.3 スケーラビリティ
- 同時ユーザー数: 1000人対応
- イベントデータ: 最大500件まで拡張可能

## 4. 技術仕様

### 4.1 新規モジュール構成

```
services/
├── eventCollector/
│   ├── stageCollectors/
│   │   ├── majorEventCollector.ts     # Stage1: 大規模イベント
│   │   ├── municipalityCollector.ts   # Stage2: 市町村別
│   │   └── categoryCollector.ts       # Stage3: カテゴリ別
│   ├── sources/
│   │   ├── officialSources.ts         # 公式情報源定義
│   │   ├── culturalSources.ts         # 文化系情報源
│   │   └── communitySource.ts         # コミュニティ情報源
│   ├── cache/
│   │   ├── eventCache.ts              # イベントキャッシュ管理
│   │   └── cacheStrategy.ts           # キャッシュ戦略
│   └── scheduler/
│       ├── updateScheduler.ts         # 更新スケジューラ
│       └── jobQueue.ts                # ジョブキュー管理
```

### 4.2 データ構造拡張

```typescript
interface EnhancedEventInfo extends EventInfo {
  collectionStage: 1 | 2 | 3;
  sourceReliability: number;  // 0-1
  lastUpdated: Date;
  dataFreshness: 'fresh' | 'stale' | 'expired';
  verificationStatus: 'verified' | 'pending' | 'unverified';
}
```

## 5. 実装計画

### Phase 1: 基盤構築（1週間）
- [ ] 多段階収集フレームワーク作成
- [ ] 専門情報源定義
- [ ] キャッシュシステム基盤

### Phase 2: Stage別収集実装（2週間）
- [ ] Stage 1: 大規模イベント収集
- [ ] Stage 2: 市町村別収集
- [ ] Stage 3: カテゴリ特化収集

### Phase 3: 統合・最適化（1週間）
- [ ] 重複排除アルゴリズム
- [ ] データ品質検証
- [ ] パフォーマンス最適化

### Phase 4: 定期更新システム（1週間）
- [ ] 更新スケジューラ実装
- [ ] バックグラウンド処理
- [ ] エラーハンドリング

## 6. リスク管理

### 6.1 技術リスク
- **API制限**: Gemini API呼び出し制限対策
- **データ品質**: 重複・不正確データの混入防止
- **パフォーマンス**: 大量データ処理による性能劣化

### 6.2 対応策
- **Rate Limiting**: 段階的API呼び出し制御
- **データ検証**: 多層検証システム
- **分散処理**: Web Worker活用

## 7. 評価基準

### 7.1 定量指標
- イベント収集数: 目標200件以上
- データ鮮度: 平均24時間以内
- 重複率: 5%以下

### 7.2 定性指標
- ユーザー満足度調査
- 地域イベント発見率
- システム安定性評価