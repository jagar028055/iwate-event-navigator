# 岩手イベントナビゲーター - 完璧要件定義書 2025

## 📋 プロジェクト概要

### プロジェクト名
**岩手イベントナビゲーター** (Iwate Event Navigator)

### ビジョン
岩手県内のすべてのイベント情報を、AIと地図技術を活用して、誰でも簡単に発見・参加できるプラットフォームを提供する

### ミッション
地域コミュニティの活性化と観光促進を通じて、岩手県の文化的・経済的発展に貢献する

---

## 👥 ユーザー分析・ペルソナ定義

### ペルソナ1: 地元住民「佐藤 美穂」（35歳、盛岡市在住）
**プロフィール**:
- 職業: 会社員（事務職）
- 家族構成: 夫、小学生の子供2人
- デバイス: iPhone 14、iPad（家庭用）
- 技術レベル: 中級（SNS、アプリ利用に慣れている）

**利用目的**:
- 週末の家族向けイベント検索
- 子供の教育・体験機会の発見
- 地域コミュニティ活動への参加

**利用シーン**:
- 平日夜（19-21時）: 週末計画を立てる際
- 土曜朝（8-10時）: 当日参加可能なイベント検索
- 移動中（電車・バス内）: 隙間時間での情報収集

**ペインポイント**:
- 情報が分散していて一箇所で確認できない
- 子供連れでも参加しやすいイベントか判断が難しい
- 急な天候変化での代替イベント探しが困難

### ペルソナ2: 観光客「田中 健太」（28歳、東京都在住）
**プロフィール**:
- 職業: IT企業エンジニア
- 趣味: 旅行、写真撮影、地方グルメ
- デバイス: Android（Pixel 8）、MacBook Pro
- 技術レベル: 上級（新しいアプリ・サービスの早期採用者）

**利用目的**:
- 岩手訪問時の観光イベント発見
- 地元ならではの体験・食事機会の探索
- 写真映えする場所・イベントの特定

**利用シーン**:
- 旅行計画時（平日夜20-22時）: 事前リサーチ
- 現地滞在中（土日10-18時）: リアルタイム情報確認
- 移動中（新幹線・レンタカー）: 次の目的地選定

**ペインポイント**:
- 観光情報サイトの情報が古い・不正確
- 現地でしか知り得ない「隠れた」イベント情報不足
- 公共交通機関でのアクセス方法が不明

### ペルソナ3: イベント主催者「鈴木 一郎」（45歳、花巻市在住）
**プロフィール**:
- 職業: NPO法人職員、地域イベント企画
- 役割: 地域活性化イベントの企画・運営
- デバイス: Windows PC、Android スマートフォン
- 技術レベル: 中級（業務でPC使用、SNS投稿）

**利用目的**:
- 主催イベントの効果的な告知・宣伝
- 他団体イベントとの日程調整・連携
- 参加者動向の分析・改善

**利用シーン**:
- 平日業務時間（9-17時）: イベント登録・管理
- イベント開催日: リアルタイム参加者数確認
- イベント後: 参加者フィードバック分析

**ペインポイント**:
- 複数プラットフォームでの情報発信が煩雑
- 参加者の事前の関心度・期待値が把握しにくい
- イベント効果測定の手段が限定的

---

## 🎯 詳細機能要件

### 2.1 コア機能

#### 2.1.1 地図表示・操作機能

**機能概要**: 岩手県全域の対話的地図表示とイベント位置マッピング

**詳細仕様**:
```typescript
interface MapConfiguration {
  center: [number, number]  // 岩手県中心座標 [39.7036, 141.1527]
  initialZoom: number       // 初期ズームレベル 9
  minZoom: number          // 最小ズーム 7
  maxZoom: number          // 最大ズーム 18
  tileProvider: 'openstreetmap' | 'gsi' // タイルプロバイダー選択
}

interface MapControls {
  zoomControl: boolean      // ズーム制御表示
  fullscreenControl: boolean // フルスクリーン制御
  locationControl: boolean   // 現在位置制御
  layerControl: boolean     // レイヤー切替制御
}
```

**実装要件**:
- Leaflet 1.9.4 + React Leaflet使用
- OpenStreetMap + 国土地理院地図のレイヤー切替
- レスポンシブデザイン（320px-2560px対応）
- タッチジェスチャー完全対応（pinch zoom, pan, tap）
- 高速レンダリング（地図タイル読み込み2秒以内）

**パフォーマンス要件**:
- 地図初期表示: 3秒以内
- 地図操作レスポンス: 100ms以内
- タイルキャッシュ: ブラウザストレージ50MB上限

#### 2.1.2 イベント検索・フィルタリング

**機能概要**: 多軸検索とAI支援による直感的なイベント発見

**検索軸**:
```typescript
interface EventFilters {
  keyword: string           // キーワード検索
  location: {
    center: [number, number]
    radius: number         // km単位
  }
  dateRange: {
    start: Date
    end: Date
  }
  categories: EventCategory[]
  priceRange: {
    min: number
    max: number
  }
  accessibility: AccessibilityOption[]
  targetAge: AgeGroup[]
  transportAccess: TransportType[]
}

enum EventCategory {
  FESTIVAL = 'festival',
  CULTURAL = 'cultural', 
  SPORTS = 'sports',
  FOOD = 'food',
  NATURE = 'nature',
  WORKSHOP = 'workshop'
}
```

**実装仕様**:
- デバウンス検索（300ms遅延）
- 検索結果ページネーション（20件/ページ）
- 保存済み検索条件（localStorage）
- 検索履歴（最大10件）

#### 2.1.3 AIによるイベント推薦（Gemini API活用）

**機能概要**: ユーザー行動・嗜好分析に基づくパーソナライズ推薦

**AI統合アーキテクチャ**:
```typescript
interface RecommendationRequest {
  userId: string
  userProfile: {
    age: number
    interests: string[]
    visitHistory: EventHistory[]
    locationPreferences: LocationPreference[]
  }
  contextualInfo: {
    currentLocation?: [number, number]
    weatherForecast?: WeatherInfo
    companionType: 'solo' | 'family' | 'friends'
    availableTime: number // 分単位
  }
}

interface AIRecommendationResponse {
  recommendations: RecommendedEvent[]
  explanation: string
  confidence: number // 0-1の信頼度
  alternatives: AlternativeEvent[]
}
```

**Gemini API連携仕様**:
- Cloudflare Workers経由でAPI呼び出し
- プロンプトエンジニアリング最適化
- レスポンス時間3秒以内目標
- エラー処理・フォールバック戦略実装

#### 2.1.4 イベント詳細表示

**表示情報構造**:
```typescript
interface EventDetail {
  basicInfo: {
    title: string
    description: string
    organizer: Organizer
    category: EventCategory
    tags: string[]
  }
  scheduleInfo: {
    startDateTime: Date
    endDateTime: Date
    duration: number // 分
    recurringPattern?: RecurringPattern
  }
  locationInfo: {
    venue: Venue
    coordinates: [number, number]
    accessInfo: AccessInfo
    parkingInfo?: ParkingInfo
  }
  participationInfo: {
    capacity: number
    currentParticipants: number
    priceInfo: PriceInfo
    registrationRequired: boolean
    registrationDeadline?: Date
    cancellationPolicy: string
  }
  mediaInfo: {
    images: ImageInfo[]
    videos: VideoInfo[]
    documents: DocumentInfo[]
  }
}
```

### 2.2 付加価値機能

#### 2.2.1 お気に入り・ブックマーク

**機能仕様**:
```typescript
interface BookmarkSystem {
  bookmarks: {
    events: BookmarkedEvent[]
    venues: BookmarkedVenue[]
    organizers: BookmarkedOrganizer[]
  }
  collections: BookmarkCollection[]
  syncSettings: {
    cloudSync: boolean
    autoSync: boolean
    syncFrequency: number // 分
  }
}

interface BookmarkedEvent {
  eventId: string
  bookmarkedAt: Date
  tags: string[]
  personalNotes: string
  reminderSettings: ReminderSettings
}
```

#### 2.2.2 カレンダー連携

**対応カレンダー**:
- Google Calendar
- Apple Calendar (iCal)
- Outlook Calendar
- ical形式ダウンロード

**連携機能**:
```typescript
interface CalendarIntegration {
  addToCalendar(event: EventDetail): Promise<CalendarEvent>
  syncBookmarkedEvents(): Promise<SyncResult>
  importCalendarEvents(): Promise<ImportedEvent[]>
  handleCalendarConflicts(conflict: ScheduleConflict): Promise<Resolution>
}
```

#### 2.2.3 シェア機能

**シェア対象プラットフォーム**:
- LINE（最優先 - 日本の利用率考慮）
- Twitter/X
- Facebook
- Instagram（ストーリーズ対応）
- メール・SMS
- QRコード生成

**実装仕様**:
```typescript
interface ShareContent {
  event: EventDetail
  customMessage?: string
  shareType: ShareType
  trackingParams: TrackingParameters
}

enum ShareType {
  EVENT_DETAIL = 'event_detail',
  EVENT_LIST = 'event_list',
  VENUE_INFO = 'venue_info',
  CUSTOM_ROUTE = 'custom_route'
}
```

#### 2.2.4 ルート案内・ナビゲーション

**交通手段対応**:
- 徒歩（Google Directions API）
- 車（道路状況考慮）
- 公共交通機関（バス・電車）
- 自転車

**実装仕様**:
```typescript
interface NavigationService {
  calculateRoute(origin: Coordinates, destination: Coordinates, mode: TravelMode): Promise<RouteResult>
  getPublicTransitInfo(route: RouteResult): Promise<TransitInfo>
  getRealTimeTrafficInfo(route: RouteResult): Promise<TrafficInfo>
  generateNavigationInstructions(route: RouteResult): NavigationStep[]
}
```

### 2.3 PWA機能

#### 2.3.1 オフライン対応

**オフライン戦略**:
```typescript
interface OfflineStrategy {
  mapTiles: {
    cacheRadius: number // km
    zoomLevels: number[] // キャッシュする詳細レベル
    updateFrequency: number // 日数
  }
  eventData: {
    cacheStrategy: 'stale-while-revalidate' | 'cache-first'
    maxAge: number // ミリ秒
    maxItems: number
  }
  userGenerated: {
    queueStrategy: 'sync-when-online'
    conflictResolution: ConflictResolutionStrategy
  }
}
```

**Service Worker実装**:
```javascript
// sw.js - キャッシュ戦略
const CACHE_STRATEGIES = {
  'map-tiles': 'CacheFirst',
  'api-data': 'NetworkFirst', 
  'static-assets': 'StaleWhileRevalidate',
  'user-content': 'NetworkOnly'
}
```

#### 2.3.2 プッシュ通知

**通知類型**:
```typescript
interface NotificationTypes {
  eventReminder: EventReminderNotification
  weatherAlert: WeatherAlertNotification
  newRecommendation: RecommendationNotification
  eventUpdate: EventUpdateNotification
  locationBased: LocationBasedNotification
}

interface NotificationSettings {
  enabled: boolean
  timing: NotificationTiming
  frequency: NotificationFrequency
  categories: NotificationCategory[]
  quietHours: TimeRange
}
```

#### 2.3.3 ホーム画面インストール

**PWA Manifest設定**:
```json
{
  "name": "岩手イベントナビゲーター",
  "short_name": "岩手イベント",
  "description": "岩手県内のイベント情報を地図で検索・発見",
  "start_url": "/",
  "display": "standalone",
  "orientation": "portrait-primary",
  "background_color": "#ffffff",
  "theme_color": "#2196f3",
  "icons": [
    {
      "src": "/icons/icon-192.png",
      "sizes": "192x192",
      "type": "image/png"
    },
    {
      "src": "/icons/icon-512.png", 
      "sizes": "512x512",
      "type": "image/png"
    }
  ],
  "categories": ["travel", "navigation", "lifestyle"]
}
```

---

## ⚡ 非機能要件

### 3.1 パフォーマンス要件

**レスポンス時間目標**:
- ページ初期表示: 2秒以内（3G接続）
- 地図操作レスポンス: 100ms以内
- 検索結果表示: 1秒以内
- AI推薦生成: 3秒以内

**スループット要件**:
- 同時ユーザー数: 1,000人（ピーク時）
- 1日あたりAPI呼び出し: 50,000回
- データベースクエリ: 100ms以内（95パーセンタイル）

**リソース使用量**:
- メモリ使用量: 50MB以下（モバイル）
- バッテリー消費: 標準的な地図アプリの110%以下
- データ通信量: 10MB/時間以下（通常使用）

### 3.2 セキュリティ要件

**データ保護**:
```typescript
interface SecurityRequirements {
  encryption: {
    inTransit: 'TLS 1.3'
    atRest: 'AES-256'
    apiKeys: 'Environment Variables + Secret Management'
  }
  authentication: {
    method: 'OAuth2 + JWT'
    providers: ['Google', 'Apple', 'LINE']
    sessionTimeout: number // 分
  }
  authorization: {
    rbac: boolean // Role-Based Access Control
    resourceLevel: boolean
    apiRateLimit: number // requests/minute
  }
}
```

**プライバシー保護**:
- GDPR準拠データ処理
- ユーザー同意管理
- データ最小化原則
- 忘れられる権利対応

### 3.3 アクセシビリティ要件

**WCAG 2.1 AA準拠**:
- キーボードナビゲーション完全対応
- スクリーンリーダー対応（ARIA属性）
- 色覚多様性対応（色依存情報回避）
- 文字サイズ拡大対応（200%まで）

**実装要件**:
```typescript
interface AccessibilityFeatures {
  visualImpairment: {
    highContrast: boolean
    largeFonts: boolean
    screenReaderSupport: boolean
    colorBlindness: ColorBlindnessSupport
  }
  motorImpairment: {
    keyboardNavigation: boolean
    largeClickTargets: boolean // 最小44px
    gestureAlternatives: boolean
  }
  cognitiveImpairment: {
    clearLanguage: boolean
    consistentNavigation: boolean
    errorPrevention: boolean
  }
}
```

### 3.4 レスポンシブデザイン

**対応デバイス**:
```typescript
interface ResponsiveBreakpoints {
  mobile: '320px - 767px'    // スマートフォン
  tablet: '768px - 1023px'   // タブレット
  desktop: '1024px - 1439px' // デスクトップ
  large: '1440px+'           // 大画面
}

interface DeviceSpecificOptimizations {
  mobile: {
    touchTargetSize: '44px minimum'
    gestureSupport: boolean
    verticalScrollOptimization: boolean
  }
  tablet: {
    dualPaneLayout: boolean
    landscapeOptimization: boolean
  }
  desktop: {
    keyboardShortcuts: boolean
    hoverEffects: boolean
    multiColumnLayout: boolean
  }
}
```

---

## 🛠 技術仕様詳細

### 4.1 アーキテクチャ概要

**システム構成**:
```
┌─────────────────┐    ┌──────────────────┐    ┌─────────────────┐
│  React Frontend │ <──> │ Cloudflare Workers│ <──> │   Gemini API    │
│   (Vite + TS)   │      │   (API Gateway)   │      │  (AI Services)  │
└─────────────────┘    └──────────────────┘    └─────────────────┘
         │                        │
         v                        v
┌─────────────────┐    ┌──────────────────┐
│ Cloudflare Pages│    │  External APIs   │
│  (Static Hosting)│    │ (Maps, Weather) │
└─────────────────┘    └──────────────────┘
```

### 4.2 コンポーネント設計

**階層構造**:
```typescript
// App層 - 最上位アプリケーション制御
interface AppLayer {
  App: React.FC
  Router: React.FC
  AuthProvider: React.FC
  ThemeProvider: React.FC
}

// Page層 - ページ単位コンポーネント
interface PageLayer {
  HomePage: React.FC
  MapPage: React.FC
  EventDetailPage: React.FC<{ eventId: string }>
  ProfilePage: React.FC
  SettingsPage: React.FC
}

// Feature層 - 機能単位コンポーネント
interface FeatureLayer {
  EventMap: React.FC<EventMapProps>
  EventList: React.FC<EventListProps>
  SearchFilters: React.FC<SearchFiltersProps>
  AIRecommendations: React.FC<AIRecommendationsProps>
}

// UI層 - 再利用可能UIコンポーネント
interface UILayer {
  Button: React.FC<ButtonProps>
  Card: React.FC<CardProps>
  Modal: React.FC<ModalProps>
  Input: React.FC<InputProps>
}
```

### 4.3 状態管理戦略（Zustand）

**ストア設計**:
```typescript
// メインアプリケーション状態
interface AppStore {
  // UI状態
  ui: {
    loading: boolean
    error: string | null
    theme: 'light' | 'dark'
    locale: string
  }
  
  // ユーザー状態
  user: {
    profile: UserProfile | null
    preferences: UserPreferences
    bookmarks: BookmarkedItem[]
    history: UserHistory[]
  }
  
  // イベント状態
  events: {
    list: Event[]
    filters: EventFilters
    searchResults: SearchResults
    recommendedEvents: Event[]
    selectedEvent: Event | null
  }
  
  // 地図状態
  map: {
    center: [number, number]
    zoom: number
    bounds: LatLngBounds
    selectedMarkers: string[]
    layerSettings: LayerSettings
  }
  
  // アクション定義
  actions: {
    // UI アクション
    setLoading: (loading: boolean) => void
    setError: (error: string | null) => void
    setTheme: (theme: 'light' | 'dark') => void
    
    // ユーザーアクション
    setUserProfile: (profile: UserProfile) => void
    updatePreferences: (preferences: Partial<UserPreferences>) => void
    addBookmark: (item: BookmarkedItem) => void
    
    // イベントアクション
    fetchEvents: (filters?: EventFilters) => Promise<void>
    searchEvents: (query: string) => Promise<void>
    selectEvent: (eventId: string) => void
    
    // 地図アクション  
    updateMapView: (center: [number, number], zoom: number) => void
    selectMarker: (markerId: string) => void
  }
}
```

### 4.4 API設計

**REST API仕様**:
```typescript
// ベースAPI設定
interface APIConfiguration {
  baseURL: 'https://iwate-events-api.your-domain.workers.dev'
  timeout: 10000 // ms
  retryAttempts: 3
  rateLimiting: {
    requests: 100
    period: 60000 // 1分
  }
}

// エンドポイント定義
interface APIEndpoints {
  // イベント関連
  'GET /api/events': {
    query: EventFilters
    response: PaginatedResponse<Event>
  }
  
  'GET /api/events/:id': {
    params: { id: string }
    response: EventDetail
  }
  
  'POST /api/events/search': {
    body: { query: string, filters?: EventFilters }
    response: SearchResults
  }
  
  // AI推薦
  'POST /api/recommendations': {
    body: RecommendationRequest
    response: AIRecommendationResponse
  }
  
  // ユーザー関連
  'GET /api/user/profile': {
    response: UserProfile
  }
  
  'PUT /api/user/preferences': {
    body: UserPreferences
    response: UpdateResult
  }
  
  // ブックマーク
  'GET /api/user/bookmarks': {
    response: BookmarkedItem[]
  }
  
  'POST /api/user/bookmarks': {
    body: BookmarkRequest
    response: BookmarkedItem
  }
}
```

### 4.5 データモデル

**コアエンティティ**:
```typescript
// イベントモデル
interface Event {
  id: string
  title: string
  description: string
  organizer: Organizer
  category: EventCategory
  tags: string[]
  
  // 日時情報
  startDateTime: Date
  endDateTime: Date
  timezone: string
  recurringPattern?: RecurringPattern
  
  // 場所情報
  venue: Venue
  coordinates: [number, number] // [lat, lng]
  address: Address
  
  // 参加情報
  capacity: number
  currentParticipants: number
  priceInfo: PriceInfo
  registrationInfo: RegistrationInfo
  
  // メディア情報
  images: ImageInfo[]
  videos?: VideoInfo[]
  
  // メタデータ
  createdAt: Date
  updatedAt: Date
  publishedAt: Date
  status: EventStatus
  visibility: EventVisibility
}

// 会場モデル
interface Venue {
  id: string
  name: string
  description?: string
  coordinates: [number, number]
  address: Address
  capacity: number
  facilities: Facility[]
  accessibility: AccessibilityInfo
  contactInfo: ContactInfo
  images: ImageInfo[]
}

// ユーザーモデル
interface User {
  id: string
  profile: {
    displayName: string
    email: string
    avatar?: string
    bio?: string
  }
  preferences: {
    language: string
    timezone: string
    notifications: NotificationSettings
    accessibility: AccessibilityPreferences
    privacy: PrivacySettings
  }
  locationInfo?: {
    homeLocation: [number, number]
    preferredRadius: number
    transportModes: TransportMode[]
  }
  metadata: {
    createdAt: Date
    lastLoginAt: Date
    accountStatus: AccountStatus
  }
}
```

---

## 📖 ユーザーストーリー

### US-001: 基本地図表示
**As a** 地元住民  
**I want** 岩手県の地図上でイベントを地理的に確認したい  
**So that** 自宅からの距離や移動時間を考慮してイベントを選択できる

**受け入れ条件**:
- Given 岩手イベントナビゲーターのホームページにアクセスしたとき
- When ページが読み込み完了すると
- Then 岩手県全体が見える縮尺の地図が3秒以内に表示される
- And 地図上に現在開催中・開催予定のイベントがマーカーで表示される
- And マーカーをタップするとイベントの基本情報がポップアップ表示される

### US-002: イベント検索とフィルタリング
**As a** 観光客  
**I want** 特定の条件（日付、カテゴリ、場所）でイベントを絞り込みたい  
**So that** 限られた滞在時間の中で最適なイベントを効率的に発見できる

**受け入れ条件**:
- Given 地図ページまたは検索ページにいるとき
- When 検索条件（キーワード、日付範囲、カテゴリ）を入力すると
- Then 1秒以内に条件に合致するイベントが表示される
- And 結果は関連度順または日付順で並び替えが可能である
- And 検索条件は次回訪問時まで保存される

### US-003: AI イベント推薦
**As a** 地元住民  
**I want** 過去の参加履歴や興味に基づいて新しいイベントを提案してもらいたい  
**So that** 自分では見つけられなかった魅力的なイベントを発見できる

**受け入れ条件**:
- Given ユーザーアカウントにログインしているとき
- When 推薦ページまたはホームページにアクセスすると
- Then 3秒以内にパーソナライズされた推薦イベントが3-5件表示される
- And 各推薦には「なぜ推薦されたか」の理由が表示される
- And 推薦を「興味ある」「興味ない」で評価でき、今後の推薦に反映される

### US-004: イベント詳細確認
**As a** すべてのユーザー  
**I want** イベントの詳細情報（時間、場所、料金、アクセス方法）を確認したい  
**So that** 参加の可否を適切に判断できる

**受け入れ条件**:
- Given イベントマーカーまたはリストアイテムをタップしたとき
- When イベント詳細ページが開くと
- Then 500ms以内にイベントの全詳細情報が構造化して表示される
- And アクセス方法（徒歩、車、公共交通）が地図付きで表示される
- And 天気予報や関連イベント情報も合わせて表示される

### US-005: お気に入り登録と管理
**As a** すべてのユーザー  
**I want** 興味のあるイベントをお気に入り登録して後で確認したい  
**So that** 複数のイベントを比較検討して参加を決められる

**受け入れ条件**:
- Given イベント詳細を確認しているとき
- When お気に入りボタンをタップすると
- Then 即座にお気に入りリストに追加される
- And マイページでお気に入りイベントを一覧確認できる
- And お気に入りイベントの開催が近づくとプッシュ通知される

### US-006: カレンダー連携
**As a** 地元住民  
**I want** 参加予定のイベントを自分のカレンダーアプリに登録したい  
**So that** 他の予定と合わせて日程管理できる

**受け入れ条件**:
- Given イベント詳細ページで「カレンダーに追加」ボタンをタップしたとき
- When カレンダーアプリ選択画面が表示されると
- Then Google Calendar、Apple Calendar、Outlookから選択できる
- And 選択したカレンダーアプリが開き、イベント情報が自動入力される
- And 場所情報も正確に設定され、ナビゲーションが可能な状態になる

### US-007: イベント共有
**As a** すべてのユーザー  
**I want** 興味深いイベントを友人・家族と簡単に共有したい  
**So that** 一緒にイベントに参加できる

**受け入れ条件**:
- Given イベント詳細を確認しているとき
- When 共有ボタンをタップすると
- Then SNS（LINE、Twitter、Facebook）、メール、QRコード生成から選択できる
- And 共有メッセージには イベント名、日時、場所、詳細URLが含まれる
- And 受信者がリンクをタップすると該当イベントの詳細が直接表示される

### US-008: 現在地からの近いイベント検索
**As a** 観光客  
**I want** 現在地から近い場所で開催されているイベントを確認したい  
**So that** 移動時間を最小限に抑えて効率的に観光できる

**受け入れ条件**:
- Given 位置情報許可を与えているとき
- When 「近くのイベント」ボタンをタップすると
- Then 現在地から5km以内のイベントが距離順で表示される
- And 各イベントには徒歩・車での到着時間が表示される
- And 実際のナビゲーション機能にワンタップで移行できる

### US-009: オフライン地図閲覧
**As a** すべてのユーザー  
**I want** 通信環境が悪い場所でも地図とイベント情報を確認したい  
**So that** 山間部や通信制限時でもアプリを利用できる

**受け入れ条件**:
- Given 事前にアプリを使用してデータキャッシュがある状態で
- When ネットワーク接続がない環境でアプリを開くと
- Then キャッシュされた地図とイベント情報が表示される
- And「オフライン中」であることがステータスバーに表示される
- And ネットワーク復帰時に自動的に最新データに同期される

### US-010: プッシュ通知設定・受信
**As a** 地元住民  
**I want** 新しいイベント情報や開催リマインダーを通知で受け取りたい  
**So that** 重要なイベントを見逃すことなく参加できる

**受け入れ条件**:
- Given 通知許可を与えてユーザー設定を行ったとき
- When 設定した条件（カテゴリ、場所、時間）に合致するイベントが登録されると
- Then 即座にプッシュ通知が送信される
- And お気に入り登録したイベントの開催24時間前にリマインダー通知される
- And 通知をタップすると該当イベントの詳細画面が直接開く

### US-011: 天候連動イベント提案
**As a** すべてのユーザー  
**I want** 天気予報に応じて適切なイベントを提案してもらいたい  
**So that** 天候に左右されることなくイベントを楽しめる

**受け入れ条件**:
- Given 天気予報APIから雨天予報を取得したとき
- When ホームページまたは推薦ページにアクセスすると
- Then 屋内イベントが優先的に表示される
- And 「雨天でも楽しめるイベント」として特別カテゴリで表示される
- And 晴天時には屋外イベント・自然系イベントが優先表示される

### US-012: アクセシビリティ対応
**As a** 身体的制約のあるユーザー  
**I want** 自分の制約に配慮したイベント情報とアクセス方法を確認したい  
**So that** 安心してイベントに参加できる

**受け入れ条件**:
- Given アクセシビリティ設定でニーズを設定しているとき
- When イベント検索またはイベント詳細を確認すると
- Then 車椅子対応、視覚・聴覚サポート情報が明確に表示される
- And アクセス経路でバリアフリールートが優先表示される
- And 必要に応じて会場への事前連絡手段が提供される

### US-013: イベント主催者との連携
**As a** イベント主催者  
**I want** 自分が主催するイベントの参加状況や関心度を確認したい  
**So that** イベント運営の改善や今後の企画に活用できる

**受け入れ条件**:
- Given 主催者アカウントでログインしているとき
- When 主催者ダッシュボードにアクセスすると
- Then 自分のイベントの閲覧数、お気に入り数、共有数が表示される
- And 参加者の属性（年代、地域）が匿名化された状態で確認できる
- And イベント終了後に参加者からのフィードバックを確認できる

### US-014: 多言語対応
**As a** 外国人観光客  
**I want** 英語でアプリを利用したい  
**So that** 言語の壁なく岩手のイベント情報を取得できる

**受け入れ条件**:
- Given 言語設定で英語を選択したとき
- When アプリのすべてのページにアクセスすると
- Then UI要素がすべて英語で表示される
- And イベント情報も英語説明がある場合は英語で表示される
- And 地図上の地名も英語表記に切り替わる

---

## ✅ 受け入れ条件（Acceptance Criteria）

### AC-001: パフォーマンス基準
**Given** 岩手イベントナビゲーターにアクセスするとき
**When** 各種操作を実行する
**Then** 以下のパフォーマンス基準を満たす:
- ページ初期表示: 3秒以内（3G接続）
- 地図操作レスポンス: 100ms以内
- 検索結果表示: 1秒以内
- AI推薦生成: 3秒以内

### AC-002: レスポンシブデザイン
**Given** 各種デバイスでアプリにアクセスするとき
**When** 画面サイズが変化する
**Then** 以下の条件を満たす:
- 320px - 2560px の範囲で適切に表示される
- タッチターゲットが44px以上確保される
- 横向き・縦向き両方で使いやすい設計になっている

### AC-003: セキュリティ基準
**Given** アプリケーションを使用するとき
**When** データの送受信や保存が発生する
**Then** 以下のセキュリティ要件を満たす:
- すべての通信がHTTPS(TLS 1.3)で暗号化される
- APIキーが環境変数で適切に管理される
- ユーザーデータが適切に匿名化・暗号化される

### AC-004: アクセシビリティ基準
**Given** 支援技術を使用するユーザーがアクセスするとき
**When** アプリの各機能を使用する
**Then** WCAG 2.1 AA基準を満たす:
- すべてのUI要素がキーボードでアクセス可能
- スクリーンリーダーで適切に読み上げられる
- 色のみに依存した情報表示がない

### AC-005: オフライン機能
**Given** オフライン環境でアプリを使用するとき
**When** 地図表示やイベント情報を確認する
**Then** 以下の機能が利用可能:
- 事前キャッシュされた地図タイルが表示される
- 最後に取得したイベント情報が表示される
- オンライン復帰時に自動同期される

### AC-006: PWA機能
**Given** PWA対応ブラウザでアクセスするとき
**When** インストール条件が満たされる
**Then** 以下のPWA機能が動作する:
- ホーム画面への追加が提案される
- スタンドアロンアプリとして起動する
- プッシュ通知が正常に送受信される

### AC-007: 多言語対応
**Given** 言語設定を変更するとき
**When** アプリの各画面を確認する
**Then** 選択した言語で表示される:
- 日本語・英語での完全な表示切替
- 地図上の地名も対応言語で表示
- 日付・時刻形式も地域設定に従う

### AC-008: データ同期・整合性
**Given** 複数デバイスで同じアカウントを使用するとき
**When** ひとつのデバイスでデータ変更を行う
**Then** 他のデバイスでも変更が反映される:
- お気に入り情報の同期
- ユーザー設定の同期
- 閲覧履歴の同期（プライバシー設定に応じて）

### AC-009: エラーハンドリング
**Given** システムエラーやネットワークエラーが発生するとき
**When** ユーザーが操作を継続する
**Then** 適切なエラー処理が実行される:
- ユーザーフレンドリーなエラーメッセージ表示
- 自動リトライ機能（適切な場合）
- 代替手段の提案（可能な場合）

### AC-010: プライバシー保護
**Given** ユーザーの個人情報を取り扱うとき
**When** データ収集・処理・保存を行う
**Then** プライバシー要件を満たす:
- 明示的な同意取得
- データの最小化原則
- GDPR等の法規制準拠

### AC-011: 負荷・スケーラビリティ
**Given** 同時アクセス数が増加するとき
**When** サービス負荷が上昇する
**Then** システムが適切に動作する:
- 1,000同時ユーザーまで性能劣化なし
- CDNによる静的コンテンツ配信最適化
- API レート制限による適切なリソース管理

### AC-012: 検索精度・関連性
**Given** ユーザーがイベント検索を実行するとき
**When** 検索結果が表示される
**Then** 検索精度が適切である:
- キーワード検索で関連度順の結果表示
- 地理的検索で距離順の結果表示
- フィルター条件が正確に適用される

### AC-013: AI推薦品質
**Given** AI推薦機能を使用するとき
**When** ユーザーの嗜好データが蓄積される
**Then** 推薦品質が向上する:
- 過去の行動履歴に基づく適切な推薦
- 推薦理由の明確な説明
- フィードバックによる継続的改善

### AC-014: 通知システム
**Given** プッシュ通知を設定しているとき
**When** 通知条件が満たされる
**Then** 適切な通知が送信される:
- 通知内容が正確で有用
- 通知頻度が適切（スパムにならない）
- ユーザー設定に従った通知制御

### AC-015: 地図表示品質
**Given** 地図機能を使用するとき
**When** 地図上でイベント位置を確認する
**Then** 地図表示が適切である:
- イベント位置が正確にマーキングされる
- 地図タイルの読み込みが高速
- ズーム操作で詳細情報が適切に表示

### AC-016: 決済・課金システム（将来拡張）
**Given** 有料イベントの予約機能を使用するとき
**When** 決済処理を実行する
**Then** セキュアな決済が実行される:
- PCI DSS準拠の決済処理
- 決済エラー時の適切な処理
- 領収書・確認メールの送信

### AC-017: モバイル最適化
**Given** モバイルデバイスでアプリを使用するとき
**When** 各種ジェスチャー操作を行う
**Then** モバイル特化機能が適切に動作する:
- ピンチズーム、パン操作が滑らか
- タッチフィードバックが適切
- バッテリー消費が最小限

### AC-018: データバックアップ・復元
**Given** システム障害やデータ損失が発生するとき
**When** データ復旧処理を実行する
**Then** データが適切に復元される:
- 24時間以内の自動バックアップ
- RTO: 4時間以内での復旧
- RPO: データ損失1時間以内

### AC-019: ログ・監視システム
**Given** システム運用中に問題が発生するとき
**When** ログ・監視システムが動作する
**Then** 適切な情報が記録・通知される:
- エラー発生時の詳細ログ記録
- パフォーマンス監視メトリクス
- セキュリティ異常の自動検出

### AC-020: コンプライアンス
**Given** 各種法規制・ガイドラインがあるとき
**When** サービスを提供する
**Then** 該当する要件を満たす:
- 個人情報保護法準拠
- アクセシビリティ法令準拠
- コンテンツガイドライン準拠

### AC-021: 国際化対応
**Given** 異なる地域・文化のユーザーがアクセスするとき
**When** アプリケーションを使用する
**Then** 適切な地域化がなされる:
- タイムゾーン対応
- 数値・通貨フォーマット
- 文化的配慮（色彩・象徴など）

### AC-022: API制限・レート制御
**Given** 外部APIを使用するとき
**When** API使用量が上限に近づく
**Then** 適切な制御が実行される:
- 使用量監視・アラート
- レート制限によるサービス保護
- 代替手段への自動切替

### AC-023: テスト自動化
**Given** コードベースの品質を維持するとき
**When** CI/CDパイプラインが実行される
**Then** 包括的なテストが自動実行される:
- 単体テスト80%以上のカバレッジ
- 統合テストの主要パスカバー
- E2Eテストの重要フロー確認

### AC-024: ドキュメンテーション
**Given** システムの保守・拡張を行うとき
**When** ドキュメンテーションを参照する
**Then** 必要な情報が適切に記載されている:
- API仕様書の完全性
- コンポーネントドキュメント
- デプロイ・運用手順書

### AC-025: パフォーマンス監視
**Given** 本番環境でアプリケーションが稼働するとき
**When** ユーザーがサービスを利用する
**Then** パフォーマンスが継続的に監視される:
- リアルタイムパフォーマンス監視
- ユーザー体験メトリクス収集
- 性能劣化時の自動アラート

### AC-026: セキュリティ監査
**Given** セキュリティリスクを管理するとき
**When** 定期的なセキュリティ監査を実施する
**Then** セキュリティ状態が適切に評価される:
- 脆弱性スキャンの定期実行
- 依存関係の脆弱性監視
- セキュリティパッチの迅速適用

### AC-027: 災害復旧
**Given** 大規模な災害やシステム障害が発生するとき
**When** 災害復旧計画を実行する
**Then** サービスが適切に復旧される:
- データの地理的冗長化
- 代替インフラへの切替手順
- ユーザーへの適切な情報提供

---

## 📅 プロジェクト計画・マイルストーン

### Phase 1: MVP開発（4週間）
**目標**: 基本的な地図表示とイベント一覧機能

**主要機能**:
- 岩手県地図表示（OpenStreetMap）
- 静的イベントデータ表示
- 基本検索・フィルタ機能
- レスポンシブデザイン

**成功基準**:
- Lighthouse Performance Score: 80+
- 地図表示速度: 3秒以内
- モバイル対応完全実装

### Phase 2: 機能拡張（5週間）
**目標**: AI機能統合とユーザー体験向上

**主要機能**:
- Gemini API統合
- パーソナライズ推薦
- お気に入り・ブックマーク
- カレンダー連携

**成功基準**:
- AI推薦精度: 70%以上
- API応答時間: 3秒以内
- ユーザーエンゲージメント: 20%向上

### Phase 3: PWA対応（3週間）
**目標**: ネイティブアプリ相当の体験提供

**主要機能**:
- Service Worker実装
- オフライン対応
- プッシュ通知
- ホーム画面インストール

**成功基準**:
- PWA適格性: 100%
- オフライン機能率: 90%
- 通知開封率: 15%以上

---

**レポート作成日**: 2025年8月9日  
**作成者**: Claude Code  
**プロジェクト**: 岩手イベントナビゲーター  
**ドキュメント版数**: 1.0  
**総ページ数**: 42ページ  
**総要件数**: 27受け入れ条件、14ユーザーストーリー