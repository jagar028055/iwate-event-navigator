# イベント収集システム改善 - 実装タスク詳細計画

## Phase 1: 基盤構築（7日間）

### Day 1-2: 多段階収集フレームワーク
#### Task 1.1: 基本インターフェース定義
- [ ] `IEventCollector` インターフェース作成
- [ ] `CollectionStage` 列挙型定義
- [ ] `CollectionResult` 型定義
- **担当ファイル**: `services/eventCollector/types.ts`
- **工数**: 4時間

#### Task 1.2: BaseCollector抽象クラス
- [ ] 共通収集ロジック実装
- [ ] エラーハンドリング機能
- [ ] ログ出力機能
- **担当ファイル**: `services/eventCollector/BaseCollector.ts`
- **工数**: 6時間

#### Task 1.3: CollectorManager作成
- [ ] 各Stage Collectorの統合管理
- [ ] 実行順序制御
- [ ] 結果マージ機能
- **担当ファイル**: `services/eventCollector/CollectorManager.ts`
- **工数**: 8時間

### Day 3-4: 専門情報源定義システム
#### Task 1.4: 情報源データ構造
- [ ] `InformationSource` インターフェース
- [ ] カテゴリ別情報源分類
- [ ] 信頼度スコアリング
- **担当ファイル**: `services/eventCollector/sources/SourceDefinition.ts`
- **工数**: 4時間

#### Task 1.5: 岩手県市町村データ
- [ ] 33市町村の基本情報
- [ ] 公式サイトURL一覧
- [ ] 地域コード体系
- **担当ファイル**: `services/eventCollector/sources/iwateMunicipalities.ts`
- **工数**: 6時間

#### Task 1.6: 専門機関データベース
- [ ] 神社庁・文化財課リスト
- [ ] JA・商工会議所リスト
- [ ] NPO・コミュニティ団体
- **担当ファイル**: `services/eventCollector/sources/specializedSources.ts`
- **工数**: 8時間

### Day 5-7: キャッシュシステム基盤
#### Task 1.7: EventCache設計
- [ ] メモリキャッシュ実装
- [ ] LocalStorage連携
- [ ] IndexedDB統合
- **担当ファイル**: `services/eventCollector/cache/EventCache.ts`
- **工数**: 10時間

#### Task 1.8: CacheStrategy実装
- [ ] TTL（Time To Live）管理
- [ ] LRU（Least Recently Used）アルゴリズム
- [ ] データ圧縮機能
- **担当ファイル**: `services/eventCollector/cache/CacheStrategy.ts`
- **工数**: 8時間

## Phase 2: Stage別収集実装（14日間）

### Day 8-10: Stage 1 - 大規模イベント収集
#### Task 2.1: MajorEventCollector
- [ ] 県・市公式サイト専用プロンプト
- [ ] 観光協会情報収集
- [ ] 大型イベント特化検索
- **担当ファイル**: `services/eventCollector/stageCollectors/MajorEventCollector.ts`
- **工数**: 12時間

#### Task 2.2: 公式情報源プロンプト最適化
- [ ] 岩手県公式サイト対応
- [ ] 主要市町村サイト対応
- [ ] 観光協会サイト対応
- **担当ファイル**: `services/eventCollector/prompts/officialPrompts.ts`
- **工数**: 8時間

#### Task 2.3: データ検証・正規化
- [ ] 住所正規化アルゴリズム
- [ ] 日付フォーマット統一
- [ ] 緯度経度検証
- **担当ファイル**: `services/eventCollector/validators/EventValidator.ts`
- **工数**: 6時間

### Day 11-14: Stage 2 - 市町村別収集
#### Task 2.4: MunicipalityCollector
- [ ] 33市町村ローテーション収集
- [ ] 地域特性プロンプト
- [ ] 小規模イベント検出強化
- **担当ファイル**: `services/eventCollector/stageCollectors/MunicipalityCollector.ts`
- **工数**: 16時間

#### Task 2.5: 地域別プロンプト生成
- [ ] 県央地域特化プロンプト
- [ ] 県南地域特化プロンプト
- [ ] 沿岸地域特化プロンプト
- [ ] 県北地域特化プロンプト
- **担当ファイル**: `services/eventCollector/prompts/regionalPrompts.ts`
- **工数**: 10時間

### Day 15-21: Stage 3 - カテゴリ特化収集
#### Task 2.6: CategoryCollector
- [ ] 祭り・伝統行事専用収集
- [ ] グルメ・物産イベント収集
- [ ] 文化・体験イベント収集
- **担当ファイル**: `services/eventCollector/stageCollectors/CategoryCollector.ts`
- **工数**: 18時間

#### Task 2.7: カテゴリ別検索戦略
- [ ] 祭り検索キーワード最適化
- [ ] 季節性考慮アルゴリズム
- [ ] 地域文化特性反映
- **担当ファイル**: `services/eventCollector/strategies/CategoryStrategy.ts`
- **工数**: 8時間

## Phase 3: 統合・最適化（7日間）

### Day 22-24: データ統合システム
#### Task 3.1: 重複排除アルゴリズム
- [ ] イベント名類似度判定
- [ ] 開催日・場所重複検出
- [ ] 機械学習ベース重複判定
- **担当ファイル**: `services/eventCollector/deduplication/EventDeduplicator.ts`
- **工数**: 12時間

#### Task 3.2: データ品質検証システム
- [ ] 必須項目完全性チェック
- [ ] 地理的整合性検証
- [ ] 時系列整合性検証
- **担当ファイル**: `services/eventCollector/quality/DataQualityChecker.ts`
- **工数**: 10時間

### Day 25-28: パフォーマンス最適化
#### Task 3.3: 並列処理実装
- [ ] Web Worker統合
- [ ] Promise.allSettled活用
- [ ] バッチ処理最適化
- **担当ファイル**: `services/eventCollector/performance/ParallelProcessor.ts`
- **工数**: 14時間

## Phase 4: 定期更新システム（7日間）

### Day 29-32: 更新スケジューラ
#### Task 4.1: UpdateScheduler実装
- [ ] cron式スケジューリング
- [ ] バックグラウンド実行
- [ ] 優先度別実行制御
- **担当ファイル**: `services/eventCollector/scheduler/UpdateScheduler.ts`
- **工数**: 16時間

#### Task 4.2: JobQueue管理
- [ ] Redis風キューシステム
- [ ] 失敗時リトライ機能
- [ ] 実行状況モニタリング
- **担当ファイル**: `services/eventCollector/scheduler/JobQueue.ts`
- **工数**: 10時間

### Day 33-35: 統合テスト・デプロイ
#### Task 4.3: 統合テストスイート
- [ ] 各Stage別テストケース
- [ ] エンドツーエンドテスト
- [ ] パフォーマンステスト
- **担当ファイル**: `__tests__/eventCollector/`
- **工数**: 12時間

## リソース要件

### 開発リソース
- **メイン開発者**: 1名（35日間）
- **総開発工数**: 約280時間
- **1日平均**: 8時間

### API使用量見積もり
- **Gemini API**: 1日あたり約200リクエスト
- **月間コスト**: 約$50-100（使用量による）

### インフラ要件
- **追加ストレージ**: +50MB（キャッシュデータ）
- **メモリ使用量**: +20MB（実行時）

## 優先度と依存関係

### 高優先度（必須実装）
1. Phase 1: 基盤構築
2. Task 2.1: Stage 1収集実装
3. Task 3.1: 重複排除システム

### 中優先度（重要機能）
4. Task 2.4: Stage 2市町村別収集
5. Task 4.1: 更新スケジューラ

### 低優先度（拡張機能）
6. Task 2.6: Stage 3カテゴリ特化
7. Task 3.3: パフォーマンス最適化

## 成功基準

### 定量指標
- [ ] イベント収集数: 200件以上達成
- [ ] 重複率: 5%以下維持
- [ ] 応答時間: 3秒以内

### 定性指標
- [ ] 地域祭り情報の大幅増加
- [ ] システム安定性向上
- [ ] ユーザビリティ向上